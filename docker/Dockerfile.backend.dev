FROM node:22-alpine

WORKDIR /app/backend

RUN apk add --no-cache openssl

# Install deps first (cached layer)
COPY backend/package.json backend/tsconfig.json ./
RUN npm install

# Copy prisma schema and generate
COPY backend/prisma ./prisma
RUN npx prisma generate

# Source will be mounted at runtime, but copy for initial setup
COPY backend/src ./src
COPY docker/start-backend-dev.sh /start-backend-dev.sh
RUN chmod +x /start-backend-dev.sh

EXPOSE 4000

CMD ["/start-backend-dev.sh"]
