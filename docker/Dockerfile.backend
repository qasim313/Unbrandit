FROM node:22-alpine AS base

WORKDIR /app

RUN apk add --no-cache openssl

COPY backend/package.json backend/tsconfig.json backend/prisma ./backend/
COPY backend/src ./backend/src
COPY docker/start-backend.sh /start-backend.sh

WORKDIR /app/backend

RUN npm install && npx prisma generate && npm run build

RUN chmod +x /start-backend.sh

ENV NODE_ENV=production

EXPOSE 4000

CMD ["/start-backend.sh"]

