generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String    @id @default(cuid())
  email                   String    @unique
  password                String
  emailVerified           Boolean   @default(false)
  verificationToken       String?   @unique
  verificationTokenExpiry DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  projects                Project[]
}

model Project {
  id              String        @id @default(cuid())
  user            User          @relation(fields: [userId], references: [id])
  userId          String
  name            String
  originalApkUrl  String?
  sourceUrl       String?
  packageName     String?
  appName         String?
  versionName     String?
  versionCode     Int?
  logoUrl         String?
  status          ProjectStatus @default(PENDING)
  logs            String        @default("")
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  flavors         Flavor[]
}

enum ProjectStatus {
  PENDING
  DECOMPILING
  READY
  FAILED
}

model Flavor {
  id         String    @id @default(cuid())
  project    Project   @relation(fields: [projectId], references: [id])
  projectId  String
  name       String
  configJson Json
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  builds     Build[]
  versions   FlavorVersion[]
}

model FlavorVersion {
  id         String   @id @default(cuid())
  flavor     Flavor   @relation(fields: [flavorId], references: [id])
  flavorId   String
  configJson Json
  createdAt  DateTime @default(now())
  builds     Build[]
}

model Build {
  id              String         @id @default(cuid())
  flavor          Flavor         @relation(fields: [flavorId], references: [id])
  flavorId        String
  flavorVersion   FlavorVersion? @relation(fields: [flavorVersionId], references: [id])
  flavorVersionId String?
  status          BuildStatus
  sourceUrl       String?
  sourceType      String?
  buildType       String?
  downloadUrl     String?
  logs            String         @default("")
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

enum BuildStatus {
  PENDING
  QUEUED
  RUNNING
  SUCCESS
  FAILED
}
